//////////////////////////////////////////////////////////////////////////////////////////
//                                                                                      //
//                   (C) VESTA 2019 - Planbureau voor de Leefomgeving                   //
//                                                                                      //
//////////////////////////////////////////////////////////////////////////////////////////
container DataPakketExport: isHidden = "True"
{
	parameter<bool>			Groengas              :=	/Invoer/DefaultInstellingen/Basis/Voorkeuren/Afweging/IsGroenGas;

	container BestaandeWoning
	{
			unit<UInt32>  table := Invoer/RuimtelijkeData/BAG/vbo_woonfunctie_studiegebied
			{

			attribute<bool>	Uitgesloten_bool := PlanRegioResults/Statisch/Uitgesloten_bool[Invoer/RuimtelijkeData/BAG/vbo_woonfunctie_studiegebied/Buurt_rel];
			attribute<Ratio>		p_stadsv := PlanRegioResults/p_stadsv[Invoer/RuimtelijkeData/BAG/vbo_woonfunctie_studiegebied/Buurt_rel];
			attribute<string>		IsWater  := Invoer/RuimtelijkeData/StudieGebied/buurt/IsWater[Invoer/RuimtelijkeData/BAG/vbo_woonfunctie_studiegebied/Buurt_rel];

			//attribute<string> id                                	:= code;
			//attribute<Geography/rdc_grids/m100> gridm100_rel    	:= BebouwingsComponenten/RuimtelijkeVraagComponent/gridm100_rel;
			//attribute<rdc_meter> geometry                       	:=Geography/rdc_grids/m100/point[gridm100_rel];
			
			attribute<rdc_meter> geometry                       	:=Invoer/RuimtelijkeData/BAG/vbo_woonfunctie_studiegebied/Geometry;
			
			attribute<float64> RD_X := PointRow(geometry);
			attribute<float64> RD_Y := PointCol(geometry);

			attribute<String>	I01_BU_CODE										:= Invoer/RuimtelijkeData/StudieGebied/buurt/BU_CODE[Invoer/RuimtelijkeData/BAG/vbo_woonfunctie_studiegebied/Buurt_rel];
			attribute<nrAansl> I11_nrAansluitingen								:= BebouwingsComponenten/BestaandeWoning/RuimtelijkeVraagComponent/nrAansluitingen;

			attribute<GJ_yr>	H01_warmtetotaal								:=	add(H02_Vraag_aardgas, H03_Vraag_groengas, H05_Vraag_MTwarmte, H06_Vraag_LTwarmte, H04_Vraag_elekwarmte);
				
			attribute<GJ_yr>	H02_Vraag_aardgas								:=	round(!Uitgesloten_bool ? p_stadsv * makedefined((
																				Groengas ? 0 [GJ_yr] : (
																				  Allocatie/BestaandeWoning/Metervraag/Aardgas
																				//+ Allocatie/BestaandeUtil/Metervraag/Aardgas
																				+ max_elem(
																				((1d - p_stadsv) * (1d - GebiedsAllocatie/RestWarmte/results/RestWarmte/P_vol[Invoer/RuimtelijkeData/BAG/vbo_woonfunctie_studiegebied/Buurt_rel] ) * StateNaAllocatie/HerKostenBaten/KostenD/Bijstook/Vj_Bijstook[Invoer/RuimtelijkeData/BAG/vbo_woonfunctie_studiegebied/Buurt_rel]),
																				( StateNaAllocatie/totaal/Verbruik/V_wd_gas[Invoer/RuimtelijkeData/BAG/vbo_woonfunctie_studiegebied/Buurt_rel]
																				+ StateNaAllocatie/totaal/Verbruik/V_ow_gas[Invoer/RuimtelijkeData/BAG/vbo_woonfunctie_studiegebied/Buurt_rel]
																				+ StateNaAllocatie/totaal/Verbruik/V_id_gas[Invoer/RuimtelijkeData/BAG/vbo_woonfunctie_studiegebied/Buurt_rel]))))
																				, 0.0[GJ_yr]) : 0.0[GJ_yr])[GJ_yr];
																				
			attribute<GJ_yr>	H03_Vraag_groengas								:=	round(!Uitgesloten_bool ? p_stadsv * makedefined((
																				Groengas ? (
																				  Allocatie/BestaandeWoning/Metervraag/Aardgas
																				//+ Allocatie/BestaandeUtil/Metervraag/Aardgas
																				+ max_elem(
																				((1d - p_stadsv) * (1d - GebiedsAllocatie/RestWarmte/results/RestWarmte/P_vol[Invoer/RuimtelijkeData/BAG/vbo_woonfunctie_studiegebied/Buurt_rel]) * StateNaAllocatie/HerKostenBaten/KostenD/Bijstook/Vj_Bijstook[Invoer/RuimtelijkeData/BAG/vbo_woonfunctie_studiegebied/Buurt_rel]),
																				( StateNaAllocatie/totaal/Verbruik/V_wd_gas[Invoer/RuimtelijkeData/BAG/vbo_woonfunctie_studiegebied/Buurt_rel]
																				+ StateNaAllocatie/totaal/Verbruik/V_ow_gas[Invoer/RuimtelijkeData/BAG/vbo_woonfunctie_studiegebied/Buurt_rel]
																				+ StateNaAllocatie/totaal/Verbruik/V_id_gas[Invoer/RuimtelijkeData/BAG/vbo_woonfunctie_studiegebied/Buurt_rel])))
																				: 0 [GJ_yr])
																				, 0.0[GJ_yr]) : 0.0[GJ_yr])[GJ_yr];
	
			attribute<GJ_yr>	H04_Vraag_elekwarmte							:=	round(!Uitgesloten_bool ? p_stadsv * makedefined((
																				  Allocatie/BestaandeWoning/Metervraag/eWP
																				//+ Allocatie/BestaandeUtil/Metervraag/eWP
																				+ Allocatie/BestaandeWoning/Metervraag/hWP
																				//+ Allocatie/BestaandeUtil/Metervraag/hWP
																				)
																				, 0.0[GJ_yr]) : 0.0[GJ_yr])[GJ_yr];


			attribute<GJ_yr>	H05_Vraag_MTwarmte							:=	round(!Uitgesloten_bool ? makedefined(max_elem(
																				  ((1d - p_stadsv)
																				* (BebouwingsComponenten/BestaandeWoning/DragerOpties/Warmte/Warmte
																				)),
																				  (Allocatie/BestaandeWoning/Metervraag/WarmteMT
																				//+ Allocatie/BestaandeUtil/Metervraag/WarmteMT
																				))
																				, 0.0[GJ_yr]) : 0.0[GJ_yr])[GJ_yr];


			attribute<GJ_yr>	H06_Vraag_LTwarmte								:=	round(!Uitgesloten_bool ? p_stadsv * makedefined((
																				  Allocatie/BestaandeWoning/Metervraag/WarmteLT
																				//+ Allocatie/BestaandeUtil/Metervraag/WarmteLT
																				)
																				, 0.0[GJ_yr]) : 0.0[GJ_yr])[GJ_yr];


			attribute<GJ_yr>	H08_Vraag_elektotaal							:=	round(!Uitgesloten_bool ? makedefined(
																				  (max_elem((StateNaAllocatie/totaal/verbruik/V_id_elek[Invoer/RuimtelijkeData/BAG/vbo_woonfunctie_studiegebied/Buurt_rel]
																				+ StateNaAllocatie/totaal/verbruik/V_wd_elek[Invoer/RuimtelijkeData/BAG/vbo_woonfunctie_studiegebied/Buurt_rel]
																				+ StateNaAllocatie/totaal/verbruik/V_ow_elek[Invoer/RuimtelijkeData/BAG/vbo_woonfunctie_studiegebied/Buurt_rel]),
																				((1d - p_stadsv) * StateNaAllocatie/HerKostenBaten/KostenD/SecundairNet/V_wd_elek[Invoer/RuimtelijkeData/BAG/vbo_woonfunctie_studiegebied/Buurt_rel]))
																				//+ Allocatie/BestaandeUtil/Metervraag/elektriciteit
																				+ Allocatie/BestaandeWoning/Metervraag/elektriciteit
																				//- ((1d - p_stadsv) * Allocatie/BestaandeUtil/Metervraag/eWP)
																				- ((1d - p_stadsv) * Allocatie/BestaandeWoning/Metervraag/eWP)
																				//- ((1d - p_stadsv) * Allocatie/BestaandeUtil/Metervraag/hWP)
																				- ((1d - p_stadsv) * Allocatie/BestaandeWoning/Metervraag/hWP)
																				)
																				, 0.0[GJ_yr]) : 0.0[GJ_yr])[GJ_yr];


			attribute<GJ_yr>	H09_Vraag_koude									:=	round(!Uitgesloten_bool ? makedefined((
																				  BebouwingsComponenten/BestaandeWoning/Functioneel/Koude
																				)
																				, 0.0[GJ_yr]) : 0.0[GJ_yr])[GJ_yr];


			attribute<Classifications/WarmteOptie>  C08_Warmteoptie					:= /TussenResultaten/StartJaar/AllocatieResultaten/BestaandeWoning/WarmteAllocatie;
			attribute<classifications/EnergieLabel> C09_Elabel						:= BebouwingsComponenten/BestaandeWoning/energielabel/CurrValue;
			attribute<model/CalculationSchemes/BCdata/ModelObject> C10_Model_rel	:= BebouwingsComponenten/BestaandeWoning/Model_rel;
			}

			unit<uint32> variable := SubItem_PropValues(table,'name');
			container export_csv := Rapportage/WriteTable32ToCSV(table, AsList(variable/name, ';'), FolderInfo/OutputFolder+'/Datapakket_BestaandeWoning.csv');

	}
}